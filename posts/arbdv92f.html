<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Hiểu Rõ Các Chỉ Số Retention, Life Time Value và Churn Trong Kinh Doanh và truy vấn | Blog's GluTis</title><meta name="author" content="GluTis,huyv80313@gmail.com"><meta name="copyright" content="GluTis"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="FFFAFA"><meta name="description" content="Thoạt đầu Cho những ai hay đọc blogs của mình thì nay mình lại ngoi lên để chia sẻ một số kiến thức kinh nghiệm hiện có. Xin chào, mình là GluTis một sinh viên ngành toán tại Hust. Trong thời gian đi">
<meta property="og:type" content="article">
<meta property="og:title" content="Hiểu Rõ Các Chỉ Số Retention, Life Time Value và Churn Trong Kinh Doanh và truy vấn">
<meta property="og:url" content="https://huyvu15.github.io/posts/arbdv92f">
<meta property="og:site_name" content="Blog&#39;s GluTis">
<meta property="og:description" content="Thoạt đầu Cho những ai hay đọc blogs của mình thì nay mình lại ngoi lên để chia sẻ một số kiến thức kinh nghiệm hiện có. Xin chào, mình là GluTis một sinh viên ngành toán tại Hust. Trong thời gian đi">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://www.chailease.com.vn/attachment/images/P1.png">
<meta property="article:published_time" content="2024-08-01T00:35:12.000Z">
<meta property="article:modified_time" content="2024-08-03T02:32:04.655Z">
<meta property="article:author" content="GluTis">
<meta property="article:tag" content="Documentation">
<meta property="article:tag" content="Metrics">
<meta property="article:tag" content="SQL">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://www.chailease.com.vn/attachment/images/P1.png"><link rel="shortcut icon" href="/img/about/icon.jpg"><link rel="canonical" href="https://huyvu15.github.io/posts/arbdv92f"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//www.clarity.ms"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="G2rPpjA8qhdAQYUqgC3WTFeaOfenZ71SWXKcg_WnOSk"/><meta name="baidu-site-verification" content="codeva-z19ndifHai"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?204a6d3bb0cb0e09978eff5ba3023104";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>(function(c,l,a,r,i,t,y){
    c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
    t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
    y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
})(window, document, "clarity", "script", "kmd11rvmc3");</script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"top_n_per_article":1,"unescape":true,"languages":{"hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found"}},
  translate: undefined,
  noticeOutdate: {"limitDay":30,"position":"top","messagePrev":"Bài viết này đã có","messageNext":"Ngày không cập nhật, xin lưu ý phân biệt tính kịp thời, có thể một phần đã không còn hiệu lực."},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":500},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Error',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'days',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'mediumZoom',
  Snackbar: {"chs_to_cht":"You have switched to Traditional Chinese","cht_to_chs":"You have switched to Simplified Chinese","day_to_night":"You have switched to Dark Mode","night_to_day":"You have switched to Light Mode","bgLight":"#49b1f5","bgDark":"#2d3035","position":"bottom-left"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: true,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Hiểu Rõ Các Chỉ Số Retention, Life Time Value và Churn Trong Kinh Doanh và truy vấn',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-08-03 09:32:04'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'FFFAFA')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" href="/css/card-info-btn.css"><script data-pjax charset="UTF-8" id="LA_COLLECT" src="//sdk.51.la/js-sdk-pro.min.js"></script><script data-pjax>LA.init({id:"3HPYFt9znqKItrHZ",ck:"3HPYFt9znqKItrHZ",autoTrack:true})</script><link rel="stylesheet" type="text/css" href="/css/Capoo.css"><link rel="stylesheet" type="text/css" href="/css/foot.css"><link rel="stylesheet" type="text/css" href="/css/extra.css"><meta name="generator" content="Hexo 7.1.1"><link rel="alternate" href="/atom.xml" title="Blog's GluTis" type="application/atom+xml">
<link href="https://cdn.bootcss.com/KaTeX/0.11.1/katex.min.css" rel="stylesheet" /></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/about/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">59</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">116</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">67</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/#/"><i class="fa-fw fas fa-home"></i><span> Trang chủ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tag</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-pencil"></i><span> Project</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/posts/1n6d313f/"><i class="fa-fw fa fa-arrow-up"></i><span> Nhận thông báo chi tiêu từ shopee</span></a></li><li><a class="site-page child" href="/posts/123ofe2/"><i class="fa-fw fa fa-arrow-down"></i><span> Tạo ChatBot trên Telegram</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://huyvu15.click/"><i class="fa-fw fas fa-map"></i><span> Điều hướng</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg fixed" id="page-header" style="background-image: url('https://www.chailease.com.vn/attachment/images/P1.png')"><nav id="nav"><span id="blog-info"><a href="/" title="Blog's GluTis"><img class="site-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/about/icon.jpg"/><span class="site-name">Blog's GluTis</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/#/"><i class="fa-fw fas fa-home"></i><span> Trang chủ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tag</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-pencil"></i><span> Project</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/posts/1n6d313f/"><i class="fa-fw fa fa-arrow-up"></i><span> Nhận thông báo chi tiêu từ shopee</span></a></li><li><a class="site-page child" href="/posts/123ofe2/"><i class="fa-fw fa fa-arrow-down"></i><span> Tạo ChatBot trên Telegram</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://huyvu15.click/"><i class="fa-fw fas fa-map"></i><span> Điều hướng</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Hiểu Rõ Các Chỉ Số Retention, Life Time Value và Churn Trong Kinh Doanh và truy vấn<a class="post-edit-link" href="https://github.com/huyvu15/huyvu15.github.io/tree/main/source/_posts/Business_metric.md" title="Edited on" target="_blank"><i class="fas fa-pencil-alt"></i></a></h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2024-08-01T00:35:12.000Z" title="Created 2024-08-01 07:35:12">2024-08-01</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2024-08-03T02:32:04.655Z" title="Updated 2024-08-03 09:32:04">2024-08-03</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Metrics/">Metrics</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word Count:</span><span class="word-count">3.5k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading Time:</span><span>21mins</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Hiểu Rõ Các Chỉ Số Retention, Life Time Value và Churn Trong Kinh Doanh và truy vấn"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="thoạt-đầu">Thoạt đầu</h1>
<p>Cho những ai hay đọc blogs của mình thì nay mình lại ngoi lên để chia sẻ một số kiến thức kinh nghiệm hiện có. Xin chào, mình là <code>GluTis</code> một sinh viên ngành toán tại Hust. Trong thời gian đi thực tập vừa qua mình có gặp một vài kiến thức khá thú vị, khá hay nữa. Lần đầu có cái công thức mình ngồi nghe cả buổi mới hiểu. Nó không phải là các công thức kinh tế mà tôi thường gặp, không phải đạo hàm, tích chập và cũng chả có những phép toán nào quá phức tạp, chỉ đơn giản là các phép toán đại số trên một không gian 2 chiều. Là các công thức liên quan đến các chỉ số trong kinh doanh của một doanh nghiệp tại một bài toán cụ thể.</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://hanslaser.vn/wp-content/uploads/2022/10/improving-the-metal-fabricating-industry-through-shared-knowledge-1654961211.jpg" alt=""></p>
<p>–&gt; Để hiểu và không làm mất kiến thức của bản thân thì blog này được ra đời :&gt;</p>
<p>Mình có nhận một task là làm một bảng dữ liệu để đội DA có tạo các dashboard dữ liệu theo đó. Nếu bạn học môn học <strong>DW &amp; BI</strong> rồi thì chắc các bạn sẽ ko còn xa lạ gì với các chart <strong>cohort</strong> (đa phần các bài được điểm cuối kỳ cao đều là do sử dụng chart này - có thể là do thầy rất thích những chỉ số mang tính so sánh)</p>
<p>Cohort là một loại chart đem lại ý nghĩa to lớn trong kinh doanh, nó cho ta cái nhìn tổng quát các ngày phía sau so với ngày ban đầu. Hãy cùng tham khảo một ví dụ tôi tìm được trên mạng.<br>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog.hub-js.com/wp-content/uploads/2023/04/Cohort-dashboard-1-1-816x456.png" alt=""></p>
<p>Nhìn vào một bảng cohort như này boss có thể đánh giá được theo từng ngày. Hiểu được hành vi của người dùng theo thời gian và thường là trong một gói kinh doanh nào đó (gọi là gói cho nó giống tính bao đống của package trong phân tích thiết kế hệ thông chứ mình không có định nghĩa cụ thể)</p>
<p><strong>Ý Nghĩa Của Phân Tích Chart Cohort:</strong></p>
<ol>
<li>
<p>Theo Dõi Retention Rate: Giúp hiểu rõ tỷ lệ giữ chân người dùng theo thời gian và xác định những giai đoạn mà người dùng thường xuyên rời bỏ dịch vụ.</p>
</li>
<li>
<p>Đo Lường Hiệu Quả Chiến Dịch: Cho phép doanh nghiệp đánh giá hiệu quả của các chiến dịch marketing hoặc cải tiến sản phẩm bằng cách so sánh hành vi của các cohort khác nhau.</p>
</li>
<li>
<p>Phát Hiện Vấn Đề: Giúp nhận diện các vấn đề hoặc thách thức mà người dùng gặp phải tại các thời điểm cụ thể trong hành trình sử dụng sản phẩm hoặc dịch vụ.</p>
</li>
<li>
<p>Tối Ưu Hóa Sản Phẩm: Cung cấp thông tin chi tiết để doanh nghiệp điều chỉnh và tối ưu hóa sản phẩm hoặc dịch vụ nhằm cải thiện trải nghiệm người dùng và tăng tỷ lệ giữ chân.</p>
</li>
<li>
<p>Đưa Ra Quyết Định Dữ Liệu: Hỗ trợ các quyết định dựa trên dữ liệu thực tế về hành vi của người dùng thay vì dựa vào cảm giác hoặc phỏng đoán.</p>
</li>
</ol>
<p>Không luyên thuyên nữa, bây giờ ta sẽ đi vào các metric chính.</p>
<h1 id="retention-tỷ-lệ-giữ-chân-khách-hàng-ở-lại">Retention® - tỷ lệ giữ chân khách hàng ở lại</h1>
<p>Để đánh giá tỷ lệ khách hàng quay trờ lại sử dụng dịch vụ thì các ông lớn kinh doanh nghĩ ra cái chỉ số hay ho này. Nói dễ hiểu là như này, boss bỏ ra 500 xèng để mời được một anh A đến cửa hàng của mình để mua hàng (bao gồm đủ loại chỉ phí marketing, …). Boss muốn biết là các hôm sau thì khách hàng này còn đến và đem lại doanh thu ra sao.</p>
<p>Ngày đầu anh A này đến và chỉ bỏ ra 50 xèng để mua 1 bộ quần áo - tính ra boss lỗ 450k trong ngày đầu.</p>
<p>Hôm sau anh ta lại quay lại, lần này A chi mạnh tay hơn để mua một bộ Gucci 150k - Với ngày 2 boss lại được 150k mà ko phải bỏ ra chi phí gì nhưng thực chất boss đang lỗ 300k. - đây là tôi đang giả sử nhé chứ sao mà lãi đc 150k luôn đc :V</p>
<p>Tương tự như vậy các hôm sau, boss ko phải bỏ ra chi phí gì nhưng khách hàng vẫn quay lại và tiếp tục đem lại doanh thu. Và boss muốn biết là khách hàng quay lại và đem lại doanh thu ra làm sao.</p>
<p>Đây là một ứng dụng cho triết lý:</p>
<div align="center">
  <font color='#3399FF'> Rủi ro là nguồn gốc của lợi nhuận mà lợi nhuận nó là phần thưởng của rủi ro. </font>
</div>
<p>Sẵn sàng chấp nhận lỗ để có doanh thu (re) trong các ngày sau.</p>
<p>Giả sử:</p>
<ul>
<li>ngày 1 số user sử dụng app là 1000 (event_name = “first_open”).</li>
</ul>
<p>-&gt; lúc này R0  = 1 (hiển nhiên là không có khách hàng nào rời bỏ dịch vụ do R chỉ so sánh với ngày đầu)</p>
<ul>
<li>ngày 2 số user ngày ngày đầu tiên (event_name = “first_open”) và có event_name = “session_start” vào ngày thứ 2 là 500 (tất nhiên là phải nhỏ hơn hoặc bằng ngày đầu)</li>
</ul>
<p>-&gt; lúc này R1 = <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle displaystyle="true" scriptlevel="0"><mfrac><mn>500</mn><mn>1000</mn></mfrac></mstyle></mrow><annotation encoding="application/x-tex">\dfrac{500}{1000}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.00744em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">5</span><span class="mord">0</span><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span> = 0.5 = 50%</p>
<ul>
<li>ngày 3 số user hoạt động vào ngày 3 nhưng có event_name = “first_open” vào ngày 1 là 200 (tất nhiên là phải nhỏ hơn hoặc bằng ngày 2)</li>
</ul>
<p>-&gt; lúc này R2 = <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle displaystyle="true" scriptlevel="0"><mfrac><mn>200</mn><mn>1000</mn></mfrac></mstyle></mrow><annotation encoding="application/x-tex">\dfrac{200}{1000}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.00744em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span><span class="mord">0</span><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span> = 0.2 = 20%</p>
<p>Cứ vày cho các ngày tiếp theo.</p>
<p>-&gt; R là 1 hàm nghịch biến, khi tăng ngày thì R luôn giảm</p>
<p><strong>Đồ thị Retention</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://media.licdn.com/dms/image/C5612AQHtKybfnmoRCA/article-cover_image-shrink_720_1280/0/1616135100626?e=2147483647&amp;v=beta&amp;t=fs4JUwEWSnxQMWLvVo83jbT_ag75ROLkXcDZrpox59c" alt=""></p>
<p><strong>Nếu mình họa dưới dạng query thì nó sẽ trông như vầy:</strong></p>
<h2 id="tính-tổng-user-dùng-app-trong-ngày-đầu-tổng-quát">Tính tổng user dùng app trong ngày đầu (tổng quát)</h2>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> event_date, <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> user_pseudo_id)</span><br><span class="line"><span class="keyword">FROM</span> `appkitten<span class="operator">-</span>animexa.analytics_421203129.events_<span class="operator">*</span>`</span><br><span class="line"><span class="keyword">WHERE</span> _TABLE_SUFFIX <span class="keyword">BETWEEN</span> FORMAT_DATE(<span class="string">&#x27;%Y%m%d&#x27;</span>, DATE_SUB(<span class="built_in">CURRENT_DATE</span>(), <span class="type">INTERVAL</span> <span class="number">36</span> <span class="keyword">DAY</span>)) <span class="keyword">AND</span> FORMAT_DATE(<span class="string">&#x27;%Y%m%d&#x27;</span>, <span class="built_in">CURRENT_DATE</span>())</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> event_date</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> event_date</span><br></pre></td></tr></table></figure>
<p><strong>_TABLE_SUFFIX</strong> là một lệnh đặc biết chỉ có trong Big Query cho phép bạn làm việc với các bảng được phân đoạn theo ngày hoặc các bảng có hậu tố tên tương tự</p>
<blockquote>
<p>Ví dụ cụ thể</p>
</blockquote>
<p><strong>Truy vấn các bảng với hậu tố cụ thể:</strong> Giả sử bạn có các bảng nhật ký hàng ngày với tên dạng logs_YYYYMMDD và bạn muốn truy vấn dữ liệu từ bảng logs_20230729.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> </span><br><span class="line"><span class="keyword">FROM</span> `your_project.your_dataset.logs_<span class="operator">*</span>`</span><br><span class="line"><span class="keyword">WHERE</span> _TABLE_SUFFIX <span class="operator">=</span> <span class="string">&#x27;20230729&#x27;</span></span><br></pre></td></tr></table></figure>
<p><strong>Truy vấn nhiều bảng trong một khoảng thời gian:</strong> Nếu bạn muốn truy vấn các bảng nhật ký từ ngày 2023-07-01 đến ngày 2023-07-31, bạn có thể sử dụng điều kiện _TABLE_SUFFIX với một phạm vi cụ thể.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> </span><br><span class="line"><span class="keyword">FROM</span> `your_project.your_dataset.logs_<span class="operator">*</span>`</span><br><span class="line"><span class="keyword">WHERE</span> _TABLE_SUFFIX <span class="keyword">BETWEEN</span> <span class="string">&#x27;20230701&#x27;</span> <span class="keyword">AND</span> <span class="string">&#x27;20230731&#x27;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>Nếu chỉ tính một ngày thì chỉ cần cout distinct là ok.</p>
</blockquote>
<h2 id="2-ngày-liên-tiếp">2 ngày liên tiếp</h2>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="keyword">distinct</span> user_pseudo_id)</span><br><span class="line"><span class="keyword">from</span> appkitten<span class="operator">-</span>animexa.analytics_421203129.events_20240726</span><br><span class="line"><span class="keyword">where</span> user_pseudo_id <span class="keyword">in</span> </span><br><span class="line">(</span><br><span class="line">  <span class="keyword">select</span> <span class="keyword">distinct</span> user_pseudo_id</span><br><span class="line">  <span class="keyword">from</span> appkitten<span class="operator">-</span>animexa.analytics_421203129.events_20240725</span><br><span class="line">  <span class="keyword">where</span> event_name <span class="operator">=</span> <span class="string">&#x27;first_open&#x27;</span></span><br><span class="line">) <span class="keyword">AND</span> event_name <span class="operator">=</span> <span class="string">&#x27;session_start&#x27;</span></span><br></pre></td></tr></table></figure>
<p>-&gt; Ý tưởng là dùng một truy vấn lồng để lấy <code>In </code><strong>user_pseudo_id</strong> trong ngày đầu.</p>
<h2 id="tổng-quát-cho-tất-cả-các-ngày">Tổng quát cho tất cả các ngày</h2>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WITH</span> first_open_users <span class="keyword">AS</span> (</span><br><span class="line">  <span class="keyword">SELECT</span> </span><br><span class="line">    PARSE_DATE(<span class="string">&#x27;%Y%m%d&#x27;</span>, event_date) <span class="keyword">AS</span> first_open_date,</span><br><span class="line">    user_pseudo_id</span><br><span class="line">  <span class="keyword">FROM</span> appkitten<span class="operator">-</span>animexa.analytics_421203129.events_<span class="operator">*</span></span><br><span class="line">  <span class="keyword">WHERE</span> _TABLE_SUFFIX <span class="keyword">BETWEEN</span> <span class="string">&#x27;20240701&#x27;</span> <span class="keyword">AND</span> <span class="string">&#x27;20240731&#x27;</span></span><br><span class="line">    <span class="keyword">AND</span> event_name <span class="operator">=</span> <span class="string">&#x27;first_open&#x27;</span></span><br><span class="line">),</span><br><span class="line">retention_counts <span class="keyword">AS</span> (</span><br><span class="line">  <span class="keyword">SELECT</span> </span><br><span class="line">    f.first_open_date,</span><br><span class="line">    e.user_pseudo_id,</span><br><span class="line">    DATE_DIFF(PARSE_DATE(<span class="string">&#x27;%Y%m%d&#x27;</span>, e.event_date), f.first_open_date, <span class="keyword">DAY</span>) <span class="keyword">AS</span> days_since_first_open</span><br><span class="line">  <span class="keyword">FROM</span> appkitten<span class="operator">-</span>animexa.analytics_421203129.events_<span class="operator">*</span> e</span><br><span class="line">  <span class="keyword">JOIN</span> first_open_users f <span class="keyword">ON</span> e.user_pseudo_id <span class="operator">=</span> f.user_pseudo_id</span><br><span class="line">  <span class="keyword">WHERE</span> _TABLE_SUFFIX <span class="keyword">BETWEEN</span> <span class="string">&#x27;20240701&#x27;</span> <span class="keyword">AND</span> <span class="string">&#x27;20240831&#x27;</span>  <span class="comment">-- Để bao gồm R28 cho ngày 31 tháng 7</span></span><br><span class="line">    <span class="keyword">AND</span> e.event_name <span class="operator">=</span> <span class="string">&#x27;session_start&#x27;</span></span><br><span class="line">    <span class="keyword">AND</span> PARSE_DATE(<span class="string">&#x27;%Y%m%d&#x27;</span>, e.event_date) <span class="operator">&gt;=</span> f.first_open_date</span><br><span class="line">)</span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  f.first_open_date <span class="keyword">AS</span> <span class="type">Date</span>,</span><br><span class="line">  <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> f.user_pseudo_id) <span class="keyword">AS</span> User_D0,  <span class="comment">-- số người dùng mở app lần đầu tiên vào ngày này</span></span><br><span class="line">  <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> <span class="keyword">CASE</span> <span class="keyword">WHEN</span> r.days_since_first_open <span class="operator">=</span> <span class="number">1</span> <span class="keyword">THEN</span> r.user_pseudo_id <span class="keyword">END</span>) <span class="keyword">AS</span> User_R1,</span><br><span class="line">  <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> <span class="keyword">CASE</span> <span class="keyword">WHEN</span> r.days_since_first_open <span class="operator">=</span> <span class="number">3</span> <span class="keyword">THEN</span> r.user_pseudo_id <span class="keyword">END</span>) <span class="keyword">AS</span> User_R3,</span><br><span class="line">  <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> <span class="keyword">CASE</span> <span class="keyword">WHEN</span> r.days_since_first_open <span class="operator">=</span> <span class="number">7</span> <span class="keyword">THEN</span> r.user_pseudo_id <span class="keyword">END</span>) <span class="keyword">AS</span> User_R7,</span><br><span class="line">  <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> <span class="keyword">CASE</span> <span class="keyword">WHEN</span> r.days_since_first_open <span class="operator">=</span> <span class="number">14</span> <span class="keyword">THEN</span> r.user_pseudo_id <span class="keyword">END</span>) <span class="keyword">AS</span> User_R14,</span><br><span class="line">  <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> <span class="keyword">CASE</span> <span class="keyword">WHEN</span> r.days_since_first_open <span class="operator">=</span> <span class="number">28</span> <span class="keyword">THEN</span> r.user_pseudo_id <span class="keyword">END</span>) <span class="keyword">AS</span> User_R28</span><br><span class="line"><span class="keyword">FROM</span> first_open_users f</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> retention_counts r <span class="keyword">ON</span> f.first_open_date <span class="operator">=</span> r.first_open_date <span class="keyword">AND</span> f.user_pseudo_id <span class="operator">=</span> r.user_pseudo_id</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> f.first_open_date</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> f.first_open_date</span><br></pre></td></tr></table></figure>
<h1 id="life-time-value-ltv">Life time Value(LTV)</h1>
<p>Hãy tưởng tượng bạn đang kinh doanh một cửa hàng mĩ phẩm, bạn đầu tư rất nhiều tiền cho các hoạt động digital marketing để thu hút khách hàng. Làm sao để biết được khách hàng mà bạn thu hút được có tương xứng với các chi phí mà bạn bỏ ra. Đó là lúc bạn cần biết LTV Metric (Giá trị vòng đời của khách hàng.)</p>
<p>-&gt; Dùng 500 xèng thu hút 1 cô gái đến mua mĩ phẩm, sau 5 ngày cô ấy đến mua và chi tiêu hết 550 xèng. Nghĩa là bạn đã có lãi 50 xèng.</p>
<p>-&gt; Metric này cho biết tổng số tiền kỳ vọng của một khách hàng sẽ chi trả cho doanh nghiệp của bạn trong suốt vòng đời khách hàng của họ</p>
<p><strong>Đồ thị LTV</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gopractice.io/wp-content/uploads/2022/04/Frame-120-1024x687.png" alt=""></p>
<p>Để tính thì mình chỉ cần nghĩ đơn giản là: ngày 1 khách hàng quay lại bao nhiêu đó là LTV của D1, D2 khách hàng quay lại bao nhiêu phải + khách hàng quay lại ngày 1, tương tự với D3:</p>
<blockquote>
<p>LTV_D1 = tổng những khách hàng có event_name = “session_start” ngày 1 với điều kiện có event_name = “first_open” ngày 1<br>
LTV_D2 = tổng những khách hàng có event_name = “session_start” ngày 2 với điều kiện có event_name = “first_open” ngày 1 + LTVD1<br>
LTV_D3 = tổng những khách hàng có event_name = “session_start” ngày 3 với điều kiện có event_name = “first_open” ngày 1 + LTVD2</p>
</blockquote>
<h2 id="tính-cho-2-ngày-liên-tiếp">tính cho 2 ngày liên tiếp</h2>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">```</span><br><span class="line"></span><br><span class="line">## tính cho tất cả các ngày (tổng quát)</span><br><span class="line">```<span class="keyword">sql</span></span><br><span class="line"><span class="keyword">WITH</span> first_open_users <span class="keyword">AS</span> (</span><br><span class="line">  <span class="keyword">SELECT</span> </span><br><span class="line">    PARSE_DATE(<span class="string">&#x27;%Y%m%d&#x27;</span>, event_date) <span class="keyword">AS</span> first_open_date,</span><br><span class="line">    user_pseudo_id</span><br><span class="line">  <span class="keyword">FROM</span> `appkitten<span class="operator">-</span>animexa.analytics_421203129.events_<span class="operator">*</span>`</span><br><span class="line">  <span class="keyword">WHERE</span> _TABLE_SUFFIX <span class="keyword">BETWEEN</span> <span class="string">&#x27;20240701&#x27;</span> <span class="keyword">AND</span> <span class="string">&#x27;20240731&#x27;</span></span><br><span class="line">    <span class="keyword">AND</span> event_name <span class="operator">=</span> <span class="string">&#x27;first_open&#x27;</span></span><br><span class="line">),</span><br><span class="line">session_events <span class="keyword">AS</span> (</span><br><span class="line">  <span class="keyword">SELECT</span> </span><br><span class="line">    PARSE_DATE(<span class="string">&#x27;%Y%m%d&#x27;</span>, event_date) <span class="keyword">AS</span> session_date,</span><br><span class="line">    user_pseudo_id</span><br><span class="line">  <span class="keyword">FROM</span> `appkitten<span class="operator">-</span>animexa.analytics_421203129.events_<span class="operator">*</span>`</span><br><span class="line">  <span class="keyword">WHERE</span> _TABLE_SUFFIX <span class="keyword">BETWEEN</span> <span class="string">&#x27;20240701&#x27;</span> <span class="keyword">AND</span> <span class="string">&#x27;20240831&#x27;</span></span><br><span class="line">    <span class="keyword">AND</span> event_name <span class="operator">=</span> <span class="string">&#x27;session_start&#x27;</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  f.first_open_date <span class="keyword">AS</span> <span class="type">Date</span>,</span><br><span class="line">  <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> f.user_pseudo_id) <span class="keyword">AS</span> Users_First_Open,</span><br><span class="line">  <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> <span class="keyword">CASE</span> <span class="keyword">WHEN</span> s.session_date <span class="operator">&lt;=</span> DATE_ADD(f.first_open_date, <span class="type">INTERVAL</span> <span class="number">1</span> <span class="keyword">DAY</span>) <span class="keyword">THEN</span> s.user_pseudo_id <span class="keyword">END</span>) <span class="keyword">AS</span> LTV_D1,</span><br><span class="line">  <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> <span class="keyword">CASE</span> <span class="keyword">WHEN</span> s.session_date <span class="operator">&lt;=</span> DATE_ADD(f.first_open_date, <span class="type">INTERVAL</span> <span class="number">3</span> <span class="keyword">DAY</span>) <span class="keyword">THEN</span> s.user_pseudo_id <span class="keyword">END</span>) <span class="keyword">AS</span> LTV_D3,</span><br><span class="line">  <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> <span class="keyword">CASE</span> <span class="keyword">WHEN</span> s.session_date <span class="operator">&lt;=</span> DATE_ADD(f.first_open_date, <span class="type">INTERVAL</span> <span class="number">7</span> <span class="keyword">DAY</span>) <span class="keyword">THEN</span> s.user_pseudo_id <span class="keyword">END</span>) <span class="keyword">AS</span> LTV_D7,</span><br><span class="line">  <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> <span class="keyword">CASE</span> <span class="keyword">WHEN</span> s.session_date <span class="operator">&lt;=</span> DATE_ADD(f.first_open_date, <span class="type">INTERVAL</span> <span class="number">14</span> <span class="keyword">DAY</span>) <span class="keyword">THEN</span> s.user_pseudo_id <span class="keyword">END</span>) <span class="keyword">AS</span> LTV_D14,</span><br><span class="line">  <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> <span class="keyword">CASE</span> <span class="keyword">WHEN</span> s.session_date <span class="operator">&lt;=</span> DATE_ADD(f.first_open_date, <span class="type">INTERVAL</span> <span class="number">28</span> <span class="keyword">DAY</span>) <span class="keyword">THEN</span> s.user_pseudo_id <span class="keyword">END</span>) <span class="keyword">AS</span> LTV_D28</span><br><span class="line"><span class="keyword">FROM</span> first_open_users f</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> session_events s <span class="keyword">ON</span> f.user_pseudo_id <span class="operator">=</span> s.user_pseudo_id</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> f.first_open_date</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> f.first_open_date</span><br></pre></td></tr></table></figure>
<h1 id="churn-tỷ-lệ-khách-hàng-rời-bỏ-dịch-vụ">Churn©- Tỷ lệ khách hàng rời bỏ dịch vụ</h1>
<p>Kỳ trước mình có sp một ông bạn làm bài toán dự đoán khách hàng rời bỏ.</p>
<ul>
<li>Đầu vào của mình là một bảng dữ liệu gồm khoảng 30 cột, sau khi tiền xử lý và đánh giá tương quan thì đem lại 14 cột có tương quan &gt; 0.3 một chỉ số chấp nhận được để huấn luyện mô hình dự báo.</li>
<li>Đầu ra là ứng với mỗi bản ghi có đầy đủ các thông tin trong 14 cột trên và mô hình đưa ra kết luận là khách hàng đó có rời bỏ dịch vụ hay không. Áp dụng 15 thuật toán machine để đánh giá. Thì theo như thống kê thì random forest và knn là các kĩ thuật đem lại độ chính xác cao cho mô hình (đi qua nhiều layer)</li>
</ul>
<p>Ngày đó mình biết về chỉ số này thì đã tăng được độ chính xác cho mô hình đó rồi :)))</p>
<p>Cùng một bài toán tương tự với các chỉ số trên: Có một cái app, xếp muốn mình phải đo tỷ lệ khách hàng rời bỏ dịch vụ so với ngày đầu tiên (cái gì cx so với ngày đầu nha) có event_name = “app_remove” gọi là tắt AR.</p>
<ul>
<li>ngày 1 có 1000 user tải app. và 200 user xóa app</li>
<li>ngày 2 có 200 user xóa app và có event_name = “first_open” như ngày đầu.</li>
<li>ngày 3 có 300 user xóa app và có event_name = “first_open” như ngày đầu.</li>
</ul>
<p>Thì công thức cụ thể cho trường hợp này là:</p>
<blockquote>
<p>Ngày 1:</p>
</blockquote>
<p>Churn_D0 = <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle displaystyle="true" scriptlevel="0"><mfrac><mrow><mi>A</mi><mi>R</mi><mn>1</mn><mo>−</mo><mi>a</mi><mi>t</mi><mo>−</mo><mi>D</mi><mn>0</mn><mo>∩</mo><mi>D</mi><mn>0</mn></mrow><mrow><mi>D</mi><mn>0</mn></mrow></mfrac></mstyle></mrow><annotation encoding="application/x-tex">\dfrac{AR1 - at - D0 \cap  D0}{D0}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.04633em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.36033em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="mord">0</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">A</span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault">a</span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="mord">0</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∩</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></p>
<p>-&gt; Viết theo ngôn ngữ tự nhiên thì: tỷ lệ khách hàng rời bỏ dịch vụ ngày đầu sẽ bằng tổng số user có AR ngày đầu trong điều kiện có “first_open” ngày đầu</p>
<blockquote>
<p>Vậy những ngày tiếp theo thì thế nào, ngày 2:</p>
</blockquote>
<p>Churn_D0 = <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle displaystyle="true" scriptlevel="0"><mfrac><mrow><mi>A</mi><mi>R</mi><mn>2</mn><mo>−</mo><mi>a</mi><mi>t</mi><mo>−</mo><mi>D</mi><mn>0</mn><mo>∩</mo><mi>D</mi><mn>0</mn></mrow><mrow><mi>D</mi><mn>0</mn></mrow></mfrac></mstyle></mrow><annotation encoding="application/x-tex">\dfrac{AR2 - at - D0 \cap  D0}{D0}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.04633em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.36033em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="mord">0</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">A</span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault">a</span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="mord">0</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∩</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span> + churn_d0</p>
<p>-&gt; Số khách hàng rời bỏ dịch vụ ngày 2 tất nhiên phải cộng cả ngày thứ nhất vào, do vậy tỷ lệ khách hàng rời bỏ luôn tăng</p>
<blockquote>
<p><strong>Lời giả cho bài toán trên:</strong><br>
Churn_D0 = 0.2<br>
Churn_D1 = 0.4<br>
Churn_D2 = 0.7</p>
</blockquote>
<p><strong>Đồ thị Churn</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.prod.website-files.com/6095a6b50a2535d8734740bc/60a26236a89d903f242f7071_inverse-retention-curve.jpeg" alt=""></p>
<p>Mọi người có thấy điểm gì lạ ở đây không. Đó là vào ngày đầu tiên thì khách hàng vừa có thể mở app vừa có thể xóa app luôn ngay sau đó. Như xóa đi xong tải lại - user_id vẫn được giữ nguyên do đã được định danh theo căn cước từ trước.</p>
<p>Có thể bạn vẫn khó hiểu thì tôi xin có một ví dụ như sau: xóa db đi tạo lại thì chỉ có log khác đi thôi còn người tạo vẫn là chủ tài khoản đấy thôi — rất chi là điển hình.</p>
<h2 id="cho-2-ngày-liên-tiếp">Cho 2 ngày liên tiếp</h2>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">session_start_events <span class="keyword">AS</span> (</span><br><span class="line">  <span class="keyword">SELECT</span></span><br><span class="line">    PARSE_DATE(<span class="string">&#x27;%Y%m%d&#x27;</span>, event_date) <span class="keyword">AS</span> session_start_date,</span><br><span class="line">    user_pseudo_id</span><br><span class="line">  <span class="keyword">FROM</span> `appkitten<span class="operator">-</span>animexa.analytics_421203129.events_<span class="operator">*</span>`</span><br><span class="line">  <span class="keyword">WHERE</span> _TABLE_SUFFIX <span class="keyword">BETWEEN</span> <span class="string">&#x27;20240702&#x27;</span> <span class="keyword">AND</span> <span class="string">&#x27;20240731&#x27;</span></span><br><span class="line">    <span class="keyword">AND</span> event_name <span class="operator">=</span> <span class="string">&#x27;session_start&#x27;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>-&gt; Đơn giản là lấy giao và áp dụng truy vấn lồng như trên, các ngày sau thì cộng thêm ngày trước đó là được.</p>
<h2 id="tổng-quát-cho-tất-cả-các-ngày">Tổng quát cho tất cả các ngày</h2>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WITH</span> first_open_users <span class="keyword">AS</span> (</span><br><span class="line">  <span class="keyword">SELECT</span> </span><br><span class="line">    PARSE_DATE(<span class="string">&#x27;%Y%m%d&#x27;</span>, event_date) <span class="keyword">AS</span> first_open_date,</span><br><span class="line">    user_pseudo_id</span><br><span class="line">  <span class="keyword">FROM</span> `appkitten<span class="operator">-</span>animexa.analytics_421203129.events_<span class="operator">*</span>`</span><br><span class="line">  <span class="keyword">WHERE</span> _TABLE_SUFFIX <span class="keyword">BETWEEN</span> <span class="string">&#x27;20240701&#x27;</span> <span class="keyword">AND</span> <span class="string">&#x27;20240731&#x27;</span></span><br><span class="line">    <span class="keyword">AND</span> event_name <span class="operator">=</span> <span class="string">&#x27;first_open&#x27;</span></span><br><span class="line">),</span><br><span class="line">removal_events <span class="keyword">AS</span> (</span><br><span class="line">  <span class="keyword">SELECT</span></span><br><span class="line">    PARSE_DATE(<span class="string">&#x27;%Y%m%d&#x27;</span>, event_date) <span class="keyword">AS</span> removal_date,</span><br><span class="line">    user_pseudo_id</span><br><span class="line">  <span class="keyword">FROM</span> `appkitten<span class="operator">-</span>animexa.analytics_421203129.events_<span class="operator">*</span>`</span><br><span class="line">  <span class="keyword">WHERE</span> _TABLE_SUFFIX <span class="keyword">BETWEEN</span> <span class="string">&#x27;20240701&#x27;</span> <span class="keyword">AND</span> <span class="string">&#x27;20240831&#x27;</span></span><br><span class="line">    <span class="keyword">AND</span> event_name <span class="operator">=</span> <span class="string">&#x27;app_remove&#x27;</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  f.first_open_date <span class="keyword">AS</span> <span class="type">Date</span>,</span><br><span class="line">  <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> f.user_pseudo_id) <span class="keyword">AS</span> Users_First_Open,</span><br><span class="line">  <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> <span class="keyword">CASE</span> <span class="keyword">WHEN</span> r.removal_date <span class="operator">=</span> f.first_open_date <span class="keyword">THEN</span> r.user_pseudo_id <span class="keyword">END</span>) <span class="keyword">AS</span> Churn_D0,</span><br><span class="line">  <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> <span class="keyword">CASE</span> <span class="keyword">WHEN</span> r.removal_date <span class="operator">&lt;=</span> DATE_ADD(f.first_open_date, <span class="type">INTERVAL</span> <span class="number">1</span> <span class="keyword">DAY</span>) <span class="keyword">THEN</span> r.user_pseudo_id <span class="keyword">END</span>) <span class="keyword">AS</span> Churn_D1,</span><br><span class="line">  <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> <span class="keyword">CASE</span> <span class="keyword">WHEN</span> r.removal_date <span class="operator">&lt;=</span> DATE_ADD(f.first_open_date, <span class="type">INTERVAL</span> <span class="number">3</span> <span class="keyword">DAY</span>) <span class="keyword">THEN</span> r.user_pseudo_id <span class="keyword">END</span>) <span class="keyword">AS</span> Churn_D3,</span><br><span class="line">  <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> <span class="keyword">CASE</span> <span class="keyword">WHEN</span> r.removal_date <span class="operator">&lt;=</span> DATE_ADD(f.first_open_date, <span class="type">INTERVAL</span> <span class="number">7</span> <span class="keyword">DAY</span>) <span class="keyword">THEN</span> r.user_pseudo_id <span class="keyword">END</span>) <span class="keyword">AS</span> Churn_D7,</span><br><span class="line">  <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> <span class="keyword">CASE</span> <span class="keyword">WHEN</span> r.removal_date <span class="operator">&lt;=</span> DATE_ADD(f.first_open_date, <span class="type">INTERVAL</span> <span class="number">14</span> <span class="keyword">DAY</span>) <span class="keyword">THEN</span> r.user_pseudo_id <span class="keyword">END</span>) <span class="keyword">AS</span> Churn_D14,</span><br><span class="line">  <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> <span class="keyword">CASE</span> <span class="keyword">WHEN</span> r.removal_date <span class="operator">&lt;=</span> DATE_ADD(f.first_open_date, <span class="type">INTERVAL</span> <span class="number">28</span> <span class="keyword">DAY</span>) <span class="keyword">THEN</span> r.user_pseudo_id <span class="keyword">END</span>) <span class="keyword">AS</span> Churn_D28</span><br><span class="line"><span class="keyword">FROM</span> first_open_users f</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> removal_events r <span class="keyword">ON</span> f.user_pseudo_id <span class="operator">=</span> r.user_pseudo_id</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> f.first_open_date</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> f.first_open_date</span><br></pre></td></tr></table></figure></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="https://huyvu15.github.io">GluTis</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="https://huyvu15.github.io/posts/arbdv92f">https://huyvu15.github.io/posts/arbdv92f</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Documentation/">Documentation</a><a class="post-meta__tags" href="/tags/Metrics/">Metrics</a><a class="post-meta__tags" href="/tags/SQL/">SQL</a></div><div class="post_share"><div class="social-share" data-image="https://www.chailease.com.vn/attachment/images/P1.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>Sponsor</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/money/wechat.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/money/wechat.png" alt="bank"/></a><div class="post-qr-code-desc">bank</div></li><li class="reward-item"><a href="/img/money/alipay.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/money/alipay.png" alt="bank"/></a><div class="post-qr-code-desc">bank</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/rtt5tyui" title="Ngày đáng nhớ"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://f.hoatieu.vn/data/image/2020/11/27/ke-ve-mot-ki-niem-dang-nho1.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous</div><div class="prev_info">Ngày đáng nhớ</div></div></a></div><div class="next-post pull-right"><a href="/posts/jjjj392f" title="Nghệ thuật quản lý thời gian"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://maisonoffice.vn/wp-content/uploads/2023/08/ky-nang-quan-ly-thoi-gian-3.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next</div><div class="next_info">Nghệ thuật quản lý thời gian</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><div><a href="/posts/nrbd392f" title="Hướng dẫn chạy lại base pipeline"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://www.xenonstack.com/hubfs/xenonstack-machine-learning-pipeline.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-07-23</div><div class="title">Hướng dẫn chạy lại base pipeline</div></div></a></div></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comment</span></div></div><div class="comment-wrap"><div><div id="giscus-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#tho%E1%BA%A1t-%C4%91%E1%BA%A7u"><span class="toc-number">1.</span> <span class="toc-text">Thoạt đầu</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#retention-t%E1%BB%B7-l%E1%BB%87-gi%E1%BB%AF-ch%C3%A2n-kh%C3%A1ch-h%C3%A0ng-%E1%BB%9F-l%E1%BA%A1i"><span class="toc-number">2.</span> <span class="toc-text">Retention® - tỷ lệ giữ chân khách hàng ở lại</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#t%C3%ADnh-t%E1%BB%95ng-user-d%C3%B9ng-app-trong-ng%C3%A0y-%C4%91%E1%BA%A7u-t%E1%BB%95ng-qu%C3%A1t"><span class="toc-number">2.1.</span> <span class="toc-text">Tính tổng user dùng app trong ngày đầu (tổng quát)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-ng%C3%A0y-li%C3%AAn-ti%E1%BA%BFp"><span class="toc-number">2.2.</span> <span class="toc-text">2 ngày liên tiếp</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#t%E1%BB%95ng-qu%C3%A1t-cho-t%E1%BA%A5t-c%E1%BA%A3-c%C3%A1c-ng%C3%A0y"><span class="toc-number">2.3.</span> <span class="toc-text">Tổng quát cho tất cả các ngày</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#life-time-value-ltv"><span class="toc-number">3.</span> <span class="toc-text">Life time Value(LTV)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#t%C3%ADnh-cho-2-ng%C3%A0y-li%C3%AAn-ti%E1%BA%BFp"><span class="toc-number">3.1.</span> <span class="toc-text">tính cho 2 ngày liên tiếp</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#churn-t%E1%BB%B7-l%E1%BB%87-kh%C3%A1ch-h%C3%A0ng-r%E1%BB%9Di-b%E1%BB%8F-d%E1%BB%8Bch-v%E1%BB%A5"><span class="toc-number">4.</span> <span class="toc-text">Churn©- Tỷ lệ khách hàng rời bỏ dịch vụ</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#cho-2-ng%C3%A0y-li%C3%AAn-ti%E1%BA%BFp"><span class="toc-number">4.1.</span> <span class="toc-text">Cho 2 ngày liên tiếp</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#t%E1%BB%95ng-qu%C3%A1t-cho-t%E1%BA%A5t-c%E1%BA%A3-c%C3%A1c-ng%C3%A0y"><span class="toc-number">4.2.</span> <span class="toc-text">Tổng quát cho tất cả các ngày</span></a></li></ol></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2024 By GluTis</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Hi, welcome to my <a target="_blank" rel="noopener" href="https://butterfly.js.org/">blog</a>!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="chat-btn" type="button" title="Chat"><i class="fas fa-sms"></i></button><a id="to_comment" href="#post-comment" title="Scroll To Comments"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="Back To Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@5.2.0/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@17.8.8/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.js"></script><div class="js-pjax"><script>(() => {
  const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaid.length === 0) return
  const runMermaid = () => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    Array.from($mermaid).forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
      const mermaidID = 'mermaid-' + index
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)

      const renderV10 = () => {
        renderFn.then(({svg}) => {
          mermaidSrc.insertAdjacentHTML('afterend', svg)
        })
      }

      const renderV9 = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      typeof renderFn === 'string' ? renderV9(renderFn) : renderV10()
    })
  }

  const loadMermaid = () => {
    window.loadMermaid ? runMermaid() : getScript('https://cdn.jsdelivr.net/npm/mermaid@10.8.0/dist/mermaid.min.js').then(runMermaid)
  }

  btf.addGlobalFn('themeChange', runMermaid, 'mermaid')

  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script><script>(() => {
  const abcjsInit = () => {
    const abcjsFn = () => {
      document.querySelectorAll(".abc-music-sheet").forEach(ele => {
        ABCJS.renderAbc(ele, ele.innerHTML, {responsive: 'resize'})
      })
    }
    
    typeof ABCJS === 'object' ? abcjsFn()
      : getScript('https://cdn.jsdelivr.net/npm/abcjs@6.3.0/dist/abcjs-basic-min.min.js').then(abcjsFn)
  }

  window.pjax ? abcjsInit() : window.addEventListener('load', abcjsInit)
})()</script><script>(()=>{
  const getGiscusTheme = theme => {
    return theme === 'dark' ? 'dark' : 'light'
  }

  const loadGiscus = () => {
    const config = Object.assign({
      src: 'https://giscus.app/client.js',
      'data-repo': 'huyvu15/huyvu15.github.io',
      'data-repo-id': 'R_kgDOMHLk0w',
      'data-category-id': 'DIC_kwDOMHLk084CgTi9',
      'data-mapping': 'pathname',
      'data-theme': getGiscusTheme(document.documentElement.getAttribute('data-theme')),
      'data-reactions-enabled': '1',
      crossorigin: 'anonymous',
      async: true
    },{"data-category":"Show and tell","data-mapping":"url","data-strict":0,"data-reactions-enabled":1,"data-emit-metadata":1,"data-input-position":"top","data-theme":"preferred_color_scheme","data-lang":"en","crossorigin":"anonymous"})

    const ele = document.createElement('script')
    for (let key in config) {
      ele.setAttribute(key, config[key])
    }
    document.getElementById('giscus-wrap').appendChild(ele)
  }

  const changeGiscusTheme = theme => {
    const sendMessage = message => {
      const iframe = document.querySelector('iframe.giscus-frame')
      if (!iframe) return
      iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app')
    }

    sendMessage({
      setConfig: {
        theme: getGiscusTheme(theme)
      }
    });
  }

  btf.addGlobalFn('themeChange', changeGiscusTheme, 'giscus')

  if ('Giscus' === 'Giscus' || !true) {
    if (true) btf.loadComment(document.getElementById('giscus-wrap'), loadGiscus)
    else loadGiscus()
  } else {
    window.loadOtherComment= loadGiscus
  }
})()</script></div><script data-pjax src="/js/foot.js"></script><script data-pjax src="/js/ip.js"></script><script data-pjax src="/js/Capoo.js"></script><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/canvas-fluttering-ribbon.min.js"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/click-show-text.min.js" data-mobile="false" data-text="Mình,là,GluTis" data-fontsize="15px" data-random="false" async="async"></script><script>(() => {
  const isChatBtn = true
  const isChatHideShow = true

  if (isChatBtn) {
    const close = () => {
      Chatra('minimizeWidget')
      Chatra('hide')
    }

    const open = () => {
      Chatra('openChat', true)
      Chatra('show')
    }

    window.ChatraSetup = {
      startHidden: true
    }
  
    window.chatBtnFn = () => {
      const isShow = document.getElementById('chatra').classList.contains('chatra--expanded')
      isShow ? close() : open()
    }
  } else if (isChatHideShow) {
    window.chatBtn = {
      hide: () => {
        Chatra('hide')
      },
      show: () => {
        Chatra('show')
      }
    }
  }

  (function(d, w, c) {
    w.ChatraID = 'odrCmotXiknn7yHdF'
    var s = d.createElement('script')
    w[c] = w[c] || function() {
        (w[c].q = w[c].q || []).push(arguments)
    }
    s.async = true
    s.src = 'https://call.chatra.io/chatra.js'
    if (d.head) d.head.appendChild(s)
  })(document, window, 'Chatra')

})()</script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["link[rel=\"canonical\"]","meta[property=\"og:image\"]","meta[property=\"og:title\"]","meta[property=\"og:url\"]","head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener
  btf.removeGlobalFnEvent('pjax')
  btf.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Search</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  Loading the Database</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>